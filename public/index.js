(()=>{var t={806:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function l(t){try{c(r.next(t))}catch(t){i(t)}}function u(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(l,u)}c((r=r.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},l=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return l.next=u(0),l.throw=u(1),l.return=u(2),"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function u(u){return function(c){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;l&&(l=0,u[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){i.label=u[1];break}if(6===u[0]&&i.label<o[1]){i.label=o[1],o=u;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(u);break}o[2]&&i.ops.pop(),i.trys.pop();continue}u=e.call(t,i)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var l=n(896),u=i(n(928)),c=n(935),a=n(81),s=n(932);!function(){var t=this;l.promises.readFile(u.default.join(process.cwd(),"config.json"),"utf-8").then((function(t){var e=JSON.parse(t),n=e.hosts.find((function(t){return t.root})),r=e.hosts.filter((function(t){return!t.root}));if(void 0===n)throw new Error("No root host specified");var o={rootHost:{name:n.name.split(/:/,1)[0],port:Number(n.name.split(/:/,2)[1])||80},childHosts:r.map((function(t){return{name:t.name.split(/:/,1)[0],port:Number(t.name.split(/:/,2)[1])||80,alias:t.alias?{name:t.alias.split(/:/,2)[0],port:Number(t.alias.split(/:/,2)[1])||80}:void 0}}))};(0,a.runServer)(o.rootHost,o.childHosts)})).catch((function(e){return r(t,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,l.promises.writeFile(u.default.join(process.cwd(),"config.json"),'{"version":"'.concat(process.env.npm_package_version,'","hosts":[{"name":"localhost","root":true}]}'))];case 1:return t.sent(),(0,c.log)("Error reading config file: ".concat(e.message),"Error"),(0,s.exit)(1),[2]}}))}))}))}()},206:function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.checkPing=function(t){return new Promise((function(e){var n=o.default.request({host:t,method:"HEAD"},(function(t){e(200===t.statusCode)}));n.on("error",(function(){return e(!1)})),n.end()}))},e.redirectServer=function(t,e,n,r,o){void 0===n&&(n=""),void 0===r&&(r={}),void 0===o&&(o=!1);var u=o?function(t){return Object.keys(t).map((function(e){return"".concat(e,"=").concat(l.default.compress(t[e]))})).join("&")}(r):Object.keys(r).join("&");(0,i.log)("Redirecting to ".concat(e).concat(n.length?"/"+n:"").concat(u.length?"?"+u:""),"Debug"),t.writeHead(302,{Location:"http://".concat(e).concat(n.length?"/"+n:"").concat(u.length?"?"+u:"")}),t.end()},e.parseQuery=function(t){return t.split("&").reduce((function(t,e){var n=e.split("="),r=n[0],o=n[1];return t[r]=l.default.expand(o),t}),{})};var o=r(n(611)),i=n(935),l=r(n(30))},81:function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.runServer=function(t,e){i.default.createServer((function(n,r){var f,d,h;n.setEncoding("utf-8");var p=(0,a.parseRequest)(n),g=p.url.replace(/^\//,"").split("?",2),v=g[0],m=g[1],b=m?m.split("&").reduce((function(t,e){var n=e.split("="),r=n[0],o=n[1];return t[r]=o,t}),{}):{},y=m?(0,s.parseQuery)(m):{};if((0,c.log)("".concat(p.Host,"/").concat(v," : ").concat(JSON.stringify(b)," ").concat(JSON.stringify(y)),"Debug"),p.Host.split(/:/,2)[0]===t.name&&Number(p.Host.split(/:/,2)[1]||80)===t.port){if(""===v)return r.writeHead(303,{"Content-Type":"text/html"}),void r.end('<html><head><meta http-equiv="refresh" content="0;url=/index.html"></head></html>');if("api/redirect"!==v){if(!o.default.existsSync(l.default.join(process.cwd(),"resources",v)))return r.writeHead(404,{"Content-Type":"text/plain"}),void r.end("Not Found");(0,u.getHTML)(l.default.join(process.cwd(),"resources",v)).then((function(t){r.end(t)})).catch((function(t){r.writeHead(500,{"Content-Type":"text/plain"}),r.end("Internal Server Error"),(0,c.log)("Error reading file: ".concat(t.message),"Error")}))}else{r.writeHead(200,{"Content-Type":"text/event-stream",Connection:"keep-alive","Cache-Control":"no-cache"}),r.write("data: connected\n\n");var C=setInterval((function(){null!==y.h&&((0,c.log)("Pinging to ".concat(y.h),"Debug"),i.default.get("http://".concat(y.h),(function(t){(t.statusCode||404)<400?(r.write("data: redirect\n\n"),r.end(),clearInterval(C)):r.write("data: ping\n\n")})).on("error",(function(t){(0,c.log)("Error proxying request: ".concat(t.message),"Error"),r.writeHead(500,{"Content-Type":"text/plain"}),r.end("Internal Server Error")})))}),5e3)}}else{var w=e.find((function(t){return t.name+(80!==t.port?":"+t.port:"")===p.Host}))||void 0,x=(null===(f=null==w?void 0:w.alias)||void 0===f?void 0:f.name)+(80!==(null===(d=null==w?void 0:w.alias)||void 0===d?void 0:d.port)?":"+(null===(h=null==w?void 0:w.alias)||void 0===h?void 0:h.port):"");void 0!==x?(0,s.checkPing)(x).then((function(e){e?((0,c.log)("Proxying request to ".concat(x),"Debug"),i.default.get("http://".concat(x),(function(t){r.writeHead(t.statusCode||200,t.headers),t.pipe(r,{end:!0})})).on("error",(function(t){(0,c.log)("Error proxying request: ".concat(t.message),"Error"),r.writeHead(500,{"Content-Type":"text/plain"}),r.end("Internal Server Error")}))):(0,s.redirectServer)(r,t.name+(80!==t.port?":"+t.port:""),"fallback.html",Object.assign({h:p.Host,p:v},y),!0)})).catch((function(t){(0,c.log)("Error pinging host: ".concat(t.message),"Error"),r.writeHead(500,{"Content-Type":"text/plain"}),r.end("Internal Server Error")})):((0,c.log)("Wrong host connection: ".concat(p.Host),"Error"),r.writeHead(404,{"Content-Type":"text/plain"}),r.end("Not Found"))}})).listen(t.port),(0,c.log)("Server is running on port ".concat(t.port))};var o=r(n(896)),i=r(n(611)),l=r(n(928)),u=n(341),c=n(935),a=n(38),s=n(206)},341:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function l(t){try{c(r.next(t))}catch(t){i(t)}}function u(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(l,u)}c((r=r.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},l=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return l.next=u(0),l.throw=u(1),l.return=u(2),"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function u(u){return function(c){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;l&&(l=0,u[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){i.label=u[1];break}if(6===u[0]&&i.label<o[1]){i.label=o[1],o=u;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(u);break}o[2]&&i.ops.pop(),i.trys.pop();continue}u=e.call(t,i)}catch(t){u=[6,t],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.getHTML=function(t){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,i.promises.readFile(t,"utf-8").then((function(t){return t}))];case 1:return[2,e.sent()]}}))}))};var i=n(896)},935:(t,e)=>{"use strict";function n(t,e){void 0===e&&(e="Info");for(var n=new Date,r=("00"+n.getHours()).slice(-2),o=("00"+n.getMinutes()).slice(-2),i=("00"+n.getSeconds()).slice(-2),l=0,u=t.split("\n");l<u.length;l++){var c=u[l];console.log("[".concat(r,":").concat(o,":").concat(i,"] [").concat(e,"] ").concat(c))}}Object.defineProperty(e,"__esModule",{value:!0}),e.log=n,e.logHTML=function(t){for(var e="".concat(t.method," ").concat(t.url," HTTP/").concat(t.httpVersion,"\n"),r=void 0,o=0,i=t.rawHeaders;o<i.length;o++){var l=i[o];void 0===r?r=l:(e+="".concat(r,": ").concat(l,"\n"),r=void 0)}e+="\n";var u="";t.on("data",(function(t){return u+=t})),t.on("end",(function(){e+=u})),n(e)}},38:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parseRequest=function(t){for(var e={method:t.method||"",url:t.url||"",httpVersion:t.httpVersion||""},n=void 0,r=0,o=t.rawHeaders;r<o.length;r++){var i=o[r];void 0===n?n=i:(e[n]=i,n=void 0)}var l="";return t.on("data",(function(t){return l+=t})),t.on("end",(function(){e.body+=l})),e}},30:(t,e,n)=>{t=n.nmd(t);const r=(()=>{function t(t){const e=function(t){if("string"!=typeof t)return null;const e=[];for(let n=t.length,r=0;r<n;r++){const o=t.charCodeAt(r);if(o>=55296&&o<=56319){if(r+1>=n)return null;e.push(64+(1023&o)<<10|1023&t.charCodeAt(++r))}else e.push(o)}return e}(t);if(null===e)return null;let n="";for(let t=e.length,r=0;r<t;r++){const t=e[r];if(t<=127)n+=String.fromCharCode(t);else if(t<=2047)n+=String.fromCharCode(192|t>>>6,128|191&t);else if(t<=65535)n+=String.fromCharCode(224|t>>>12,128|t>>>6&191,128|191&t);else{if(!(t<=1114111))return null;n+=String.fromCharCode(240|t>>>18,128|t>>>12&191,128|t>>>6&191,128|191&t)}}return n}function e(t){if("string"!=typeof t)return null;let e="";for(let n=0,r=t.length;n<r;n++){const o=t.charCodeAt(n);if(o<=127)e+=String.fromCharCode(o);else if(o>=194&&o<=223){if(n+1>=r)return null;const i=t.charCodeAt(++n);e+=String.fromCharCode((31&o)<<6|63&i)}else if(o>=224&&o<=239){if(n+2>=r)return null;const i=t.charCodeAt(++n),l=t.charCodeAt(++n);e+=String.fromCharCode((15&o)<<12|(63&i)<<6|63&l)}else{if(!(o>=240&&o<=244))return null;{if(n+3>=r)return null;const i=t.charCodeAt(++n),l=t.charCodeAt(++n),u=t.charCodeAt(++n);e+=String.fromCharCode(55296|((7&o)<<8|(63&i)<<2|l>>>4&3)-64,56320|(15&l)<<6|63&u)}}}return e}const n=[258,258,130,99],r=[256,256,128,97],o=[257,257,129,98],l=1e3,u=(()=>{const t=[];let e=0;for(i=0;i<128;i++)i<32&&9!==i&&10!==i||127===i?t.push(null):t.push(e++);return t})(),c=(()=>{const t=[];for(i=0;i<u.length;i++)null!==u[i]&&t.push(i);return t})(),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",s=(()=>{const t=new Map;for(let e=64,n=0;n<e;n++)t.set(a[n],n);return t})();function f(t){let e=1,n=0;for(;t>=e;)e<<=1,n++;return n}function d(t,e){const n=[];for(let r=0;r<e;r++){n.push(null);let e=r;for(;e>0&&n[e-1].count<t[r];)n[e]=n[e-1],e--;n[e]={count:t[r],symbol:r,left:null,right:null}}for(;n.length>1;){const t={count:n[n.length-2].count+n[n.length-1].count,symbol:-1,left:n[n.length-2],right:n[n.length-1]};n.pop();let e=n.length-1;for(;e>0&&n[e-1].count<t.count;)n[e]=n[e-1],e--;n[e]=t}return n[0]}function h(t,e){const n=[];for(let t=0;t<e;t++)n.push(null);const r={buf:new Uint8Array(e+7>>>3),bitNum:0},o=t=>{if(t.symbol>=0){const e=r.bitNum,o=e+7>>>3,i=new Uint8Array(o);for(let t=0;t<o;t++)i[t]=r.buf[t];n[t.symbol]={code:i,bitNum:e}}else{const e=r.bitNum;r.buf[e>>>3]&=~(1<<7-e%8),r.bitNum++,o(t.left),r.buf[e>>>3]|=1<<7-e%8,o(t.right),r.bitNum--}};return o(t),n}return{compress:function(e,i=!0){let c="",s=0,p=0;const g=i?6:8,v=t=>{const e=[3];let n=t;for(;0!==n;)n--,e.push(n%3),n=Math.floor(n/3);const r=new Uint8Array(2*e.length+6>>>3);let o=0,i=0;for(let t=e.length-1;t>=0;t--)i=(i<<2)+e[t],o+=2,o%8==0&&(r[(o>>>3)-1]=i,i=0);if(o%8!=0){const t=8-o%8;r[o>>>3]=i<<t}return{codeBuf:r,bitCnt:o}},m=(t,e)=>{let n=0,r=0,o=e;for(;o>0;)s=(s<<1)+(t[r]>>7-n&1),++p===g&&(c+=i?a[s]:String.fromCharCode(s),s=0,p=0),8==++n&&(n=0,r++),o--};if("string"!=typeof e)return null;const b=(t=>{const e=[];for(let t=0;t<256;t++)e.push(0);for(let n=t.length,r=0;r<n;r++){if(t.charCodeAt(r)>=256)return 0;e[t.charCodeAt(r)]++}for(let t=128;t<256;t++)if(e[t]>0)return 1;for(let t=u.length,n=0;n<=t;n++)if(null===u[n]&&e[n]>0)return 2;return 3})(e),y=n[b],C=r[b],w=o[b];let x;if(0===b){if(x=t(e),null===x)return null}else if(3===b){const t=u;x="";for(let n=e.length,r=0;r<n;r++)x+=String.fromCharCode(t[e.charCodeAt(r)])}else x=e;let _=[];for(let t=0;t<y;t++)_.push(.25);(t=>{const e=new Uint8Array(1);e[0]=t<<6,m(e,2)})(b);const S=[];for(let t=0;t<256;t++)S.push(null);const H=[];let A,j,E=0,k=0,M=x.length;for(;(k<256||k%8==0)&&(A=d(_,y),j=h(A,y)),!(E>=M);){let t=x.charCodeAt(E),e=0,n=0;if(E>0){let r=S[t];for(;null!==r&&E-r<=2048;){let t=1;for(;E+t-1<x.length&&x[E+t]===x[r+t]&&(t++,!(t>=l)););if(t>e&&(e=t,n=r,e>=l))break;r=H[r]}}e>=3&&(t=C),m(j[t].code,j[t].bitNum);let r=1;if(t===C){const t=v(e-3);m(t.codeBuf,t.bitCnt);const o=E-n-1,i=f(Math.min(E-1,2047)),l=new Uint8Array(2);i<=8?l[0]=o<<8-i:(l[0]=o>>i-8,l[1]=o<<16-i&255),m(l,i),r=e}for(let t=0;t<r;t++)H.push(S[x.charCodeAt(E)]),S[x.charCodeAt(E)]=E,E++;k++,_[t]++}return p>0&&(s=(s<<g-p)+(j[w].code[0]>>p+8-g),c+=i?a[s]:String.fromCharCode(s)),c},expand:function(t,i=!0){let u,a,h;const p=new Uint8Array(t.length),g=i?6:8,v=()=>{const t=h>>g-a-1&1;return++a===g&&(a=0,u++,u<j&&(h=p[u])),t},m=()=>{let t=0,e=0;do{if(u>=p.length)return-1;if(t=v(),u>=p.length)return-1;t=(t<<1)+v(),t<3&&(e=3*e+t+1)}while(t<3);return e};if("string"!=typeof t||0===t.length)return null;for(let e=t.length,n=0;n<e;n++){let e;if(i){if(e=s.get(t[n]),void 0===e)return null}else if(e=t.charCodeAt(n),e>=256)return null;p[n]=e}u=0,a=0,h=p[0];const b=(()=>{let t=v();return t=(t<<1)+v(),t})(),y=n[b],C=r[b],w=o[b];let x=[];for(let t=0;t<y;t++)x.push(.25);let _="",S=d(x,y),H=S,A=0;const j=p.length;let E=0;for(;u<j;)if(H=v()?H.right:H.left,H.symbol>=0){if(H.symbol===w)break;if(H.symbol===C){const t=m();if(t<0)return null;const e=t+3;if(e>l)return null;let n=0;const r=f(Math.min(E-1,2047));for(let t=0;t<r;t++){if(u>=j)return null;n=(n<<1)+v()}if(n>=E)return null;for(let t=0;t<e;t++)_+=_[E-n-1+t];E+=e}else _+=String.fromCharCode(H.symbol),E++;x[H.symbol]++,A++,(A<256||A%8==0)&&(S=d(x,y)),H=S}if(0===b){if(_=e(_),null===_)return null}else if(3===b){t="";for(let e=_.length,n=0;n<e;n++)t+=String.fromCharCode(c[_.charCodeAt(n)]);_=t}return _},encodeUtf8:t,decodeUtf8:e}})();null!=t&&(t.exports=r)},896:t=>{"use strict";t.exports=require("fs")},611:t=>{"use strict";t.exports=require("http")},928:t=>{"use strict";t.exports=require("path")},932:t=>{"use strict";t.exports=require("process")}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={id:r,loaded:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}n.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),n(806)})();