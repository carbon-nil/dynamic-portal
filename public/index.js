(()=>{var t={806:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function l(t){try{u(r.next(t))}catch(t){i(t)}}function c(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(l,c)}u((r=r.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},l=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return l.next=c(0),l.throw=c(1),l.return=c(2),"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function c(c){return function(u){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;l&&(l=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=e.call(t,i)}catch(t){c=[6,t],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var l=n(896),c=i(n(928)),u=n(935),a=n(81),s=n(932);!function(){var t=this;l.promises.readFile(c.default.join(process.cwd(),"config.json"),"utf-8").then((function(t){var e=JSON.parse(t),n=parseInt(e.rootHost.split(/:/,2)[1],10)||80;(0,a.runServer)(n,e)})).catch((function(e){return r(t,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,l.promises.writeFile(c.default.join(process.cwd(),"config.json"),'{"version":"'.concat(process.env.npm_package_version,'","rootHost":"localhost","childHost":[]}'))];case 1:return t.sent(),(0,u.log)("Error reading config file: ".concat(e.message),"Error"),(0,s.exit)(1),[2]}}))}))}))}()},206:function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.checkPing=function(t){return new Promise((function(e){var n=o.default.request({host:t,method:"HEAD"},(function(t){e(200===t.statusCode)}));n.on("error",(function(){return e(!1)})),n.end()}))},e.redirectServer=function(t,e,n,r,o){void 0===n&&(n=""),void 0===r&&(r={}),void 0===o&&(o=!1);var c=o?function(t){return Object.keys(t).map((function(e){return"".concat(e,"=").concat(l.default.compress(t[e]))})).join("&")}(r):Object.keys(r).join("&");(0,i.log)("Redirecting to ".concat(e).concat(n.length?"/"+n:"").concat(c.length?"?"+c:""),"Debug"),t.writeHead(302,{Location:"http://".concat(e).concat(n.length?"/"+n:"").concat(c.length?"?"+c:"")}),t.end()},e.parseQuery=function(t){return t.split("&").reduce((function(t,e){var n=e.split("="),r=n[0],o=n[1];return t[r]=l.default.expand(o),t}),{})};var o=r(n(611)),i=n(935),l=r(n(30))},81:function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.runServer=function(t,e){i.default.createServer((function(t,n){t.setEncoding("utf-8");var r=(0,a.parseRequest)(t),f=r.url.replace(/^\//,"").split("?",2),h=f[0],d=f[1],p=d?d.split("&").reduce((function(t,e){var n=e.split("="),r=n[0],o=n[1];return t[r]=o,t}),{}):{},g=d?(0,s.parseQuery)(d):{};if((0,u.log)("".concat(r.Host,"/").concat(h," : ").concat(JSON.stringify(p)," ").concat(JSON.stringify(g)),"Debug"),r.Host===e.rootHost){if(""===h)return n.writeHead(303,{"Content-Type":"text/html"}),void n.end('<html><head><meta http-equiv="refresh" content="0;url=/index.html"></head></html>');if("api/redirect"!==h){if(!o.default.existsSync(l.default.join(process.cwd(),"resources",h)))return n.writeHead(404,{"Content-Type":"text/plain"}),void n.end("Not Found");(0,c.getHTML)(l.default.join(process.cwd(),"resources",h)).then((function(t){n.end(t)})).catch((function(t){n.writeHead(500,{"Content-Type":"text/plain"}),n.end("Internal Server Error"),(0,u.log)("Error reading file: ".concat(t.message),"Error")}))}else{n.writeHead(200,{"Content-Type":"text/event-stream",Connection:"keep-alive","Cache-Control":"no-cache"}),n.write("data: connected\n\n");var v=setInterval((function(){null!==g.h&&(0,s.checkPing)(g.h.split(/:/,2)[0]).then((function(t){t?(n.write("data: redirect\n\n"),n.end(),clearInterval(v)):n.write("data: ping\n\n")})).catch((function(t){(0,u.log)("Error pinging host: ".concat(t.message),"Error"),n.writeHead(500,{"Content-Type":"text/plain"}),n.end("Internal Server Error"),clearInterval(v)}))}),5e3)}}else e.childHost.some((function(t){return t===r.Host}))?(0,s.checkPing)(r.Host.split(":",2)[0]).then((function(t){t?i.default.get(r.url,(function(t){n.writeHead(t.statusCode||200,t.headers),t.pipe(n,{end:!0})})).on("error",(function(t){(0,u.log)("Error proxying request: ".concat(t.message),"Error"),n.writeHead(500,{"Content-Type":"text/plain"}),n.end("Internal Server Error")})):(0,s.redirectServer)(n,e.rootHost,"fallback.html",Object.assign({h:r.Host,p:h},g),!0)})).catch((function(t){(0,u.log)("Error pinging host: ".concat(t.message),"Error"),n.writeHead(500,{"Content-Type":"text/plain"}),n.end("Internal Server Error")})):(n.writeHead(404,{"Content-Type":"text/plain"}),n.end("Not Found"))})).listen(t),(0,u.log)("Server is running on port ".concat(t))};var o=r(n(896)),i=r(n(611)),l=r(n(928)),c=n(341),u=n(935),a=n(38),s=n(206)},341:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function l(t){try{u(r.next(t))}catch(t){i(t)}}function c(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(l,c)}u((r=r.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},l=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return l.next=c(0),l.throw=c(1),l.return=c(2),"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function c(c){return function(u){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;l&&(l=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){i=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){i.label=c[1];break}if(6===c[0]&&i.label<o[1]){i.label=o[1],o=c;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(c);break}o[2]&&i.ops.pop(),i.trys.pop();continue}c=e.call(t,i)}catch(t){c=[6,t],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,u])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.getHTML=function(t){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,i.promises.readFile(t,"utf-8").then((function(t){return t}))];case 1:return[2,e.sent()]}}))}))};var i=n(896)},935:(t,e)=>{"use strict";function n(t,e){void 0===e&&(e="Info");for(var n=new Date,r=("00"+n.getHours()).slice(-2),o=("00"+n.getMinutes()).slice(-2),i=("00"+n.getSeconds()).slice(-2),l=0,c=t.split("\n");l<c.length;l++){var u=c[l];console.log("[".concat(r,":").concat(o,":").concat(i,"] [").concat(e,"] ").concat(u))}}Object.defineProperty(e,"__esModule",{value:!0}),e.log=n,e.logHTML=function(t){for(var e="".concat(t.method," ").concat(t.url," HTTP/").concat(t.httpVersion,"\n"),r=void 0,o=0,i=t.rawHeaders;o<i.length;o++){var l=i[o];void 0===r?r=l:(e+="".concat(r,": ").concat(l,"\n"),r=void 0)}e+="\n";var c="";t.on("data",(function(t){return c+=t})),t.on("end",(function(){e+=c})),n(e)}},38:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parseRequest=function(t){for(var e={method:t.method||"",url:t.url||"",httpVersion:t.httpVersion||""},n=void 0,r=0,o=t.rawHeaders;r<o.length;r++){var i=o[r];void 0===n?n=i:(e[n]=i,n=void 0)}var l="";return t.on("data",(function(t){return l+=t})),t.on("end",(function(){e.body+=l})),e}},30:(t,e,n)=>{t=n.nmd(t);const r=(()=>{function t(t){const e=function(t){if("string"!=typeof t)return null;const e=[];for(let n=t.length,r=0;r<n;r++){const o=t.charCodeAt(r);if(o>=55296&&o<=56319){if(r+1>=n)return null;e.push(64+(1023&o)<<10|1023&t.charCodeAt(++r))}else e.push(o)}return e}(t);if(null===e)return null;let n="";for(let t=e.length,r=0;r<t;r++){const t=e[r];if(t<=127)n+=String.fromCharCode(t);else if(t<=2047)n+=String.fromCharCode(192|t>>>6,128|191&t);else if(t<=65535)n+=String.fromCharCode(224|t>>>12,128|t>>>6&191,128|191&t);else{if(!(t<=1114111))return null;n+=String.fromCharCode(240|t>>>18,128|t>>>12&191,128|t>>>6&191,128|191&t)}}return n}function e(t){if("string"!=typeof t)return null;let e="";for(let n=0,r=t.length;n<r;n++){const o=t.charCodeAt(n);if(o<=127)e+=String.fromCharCode(o);else if(o>=194&&o<=223){if(n+1>=r)return null;const i=t.charCodeAt(++n);e+=String.fromCharCode((31&o)<<6|63&i)}else if(o>=224&&o<=239){if(n+2>=r)return null;const i=t.charCodeAt(++n),l=t.charCodeAt(++n);e+=String.fromCharCode((15&o)<<12|(63&i)<<6|63&l)}else{if(!(o>=240&&o<=244))return null;{if(n+3>=r)return null;const i=t.charCodeAt(++n),l=t.charCodeAt(++n),c=t.charCodeAt(++n);e+=String.fromCharCode(55296|((7&o)<<8|(63&i)<<2|l>>>4&3)-64,56320|(15&l)<<6|63&c)}}}return e}const n=[258,258,130,99],r=[256,256,128,97],o=[257,257,129,98],l=1e3,c=(()=>{const t=[];let e=0;for(i=0;i<128;i++)i<32&&9!==i&&10!==i||127===i?t.push(null):t.push(e++);return t})(),u=(()=>{const t=[];for(i=0;i<c.length;i++)null!==c[i]&&t.push(i);return t})(),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",s=(()=>{const t=new Map;for(let e=64,n=0;n<e;n++)t.set(a[n],n);return t})();function f(t){let e=1,n=0;for(;t>=e;)e<<=1,n++;return n}function h(t,e){const n=[];for(let r=0;r<e;r++){n.push(null);let e=r;for(;e>0&&n[e-1].count<t[r];)n[e]=n[e-1],e--;n[e]={count:t[r],symbol:r,left:null,right:null}}for(;n.length>1;){const t={count:n[n.length-2].count+n[n.length-1].count,symbol:-1,left:n[n.length-2],right:n[n.length-1]};n.pop();let e=n.length-1;for(;e>0&&n[e-1].count<t.count;)n[e]=n[e-1],e--;n[e]=t}return n[0]}function d(t,e){const n=[];for(let t=0;t<e;t++)n.push(null);const r={buf:new Uint8Array(e+7>>>3),bitNum:0},o=t=>{if(t.symbol>=0){const e=r.bitNum,o=e+7>>>3,i=new Uint8Array(o);for(let t=0;t<o;t++)i[t]=r.buf[t];n[t.symbol]={code:i,bitNum:e}}else{const e=r.bitNum;r.buf[e>>>3]&=~(1<<7-e%8),r.bitNum++,o(t.left),r.buf[e>>>3]|=1<<7-e%8,o(t.right),r.bitNum--}};return o(t),n}return{compress:function(e,i=!0){let u="",s=0,p=0;const g=i?6:8,v=t=>{const e=[3];let n=t;for(;0!==n;)n--,e.push(n%3),n=Math.floor(n/3);const r=new Uint8Array(2*e.length+6>>>3);let o=0,i=0;for(let t=e.length-1;t>=0;t--)i=(i<<2)+e[t],o+=2,o%8==0&&(r[(o>>>3)-1]=i,i=0);if(o%8!=0){const t=8-o%8;r[o>>>3]=i<<t}return{codeBuf:r,bitCnt:o}},y=(t,e)=>{let n=0,r=0,o=e;for(;o>0;)s=(s<<1)+(t[r]>>7-n&1),++p===g&&(u+=i?a[s]:String.fromCharCode(s),s=0,p=0),8==++n&&(n=0,r++),o--};if("string"!=typeof e)return null;const b=(t=>{const e=[];for(let t=0;t<256;t++)e.push(0);for(let n=t.length,r=0;r<n;r++){if(t.charCodeAt(r)>=256)return 0;e[t.charCodeAt(r)]++}for(let t=128;t<256;t++)if(e[t]>0)return 1;for(let t=c.length,n=0;n<=t;n++)if(null===c[n]&&e[n]>0)return 2;return 3})(e),m=n[b],C=r[b],w=o[b];let x;if(0===b){if(x=t(e),null===x)return null}else if(3===b){const t=c;x="";for(let n=e.length,r=0;r<n;r++)x+=String.fromCharCode(t[e.charCodeAt(r)])}else x=e;let _=[];for(let t=0;t<m;t++)_.push(.25);(t=>{const e=new Uint8Array(1);e[0]=t<<6,y(e,2)})(b);const S=[];for(let t=0;t<256;t++)S.push(null);const H=[];let A,j,k=0,E=0,M=x.length;for(;(E<256||E%8==0)&&(A=h(_,m),j=d(A,m)),!(k>=M);){let t=x.charCodeAt(k),e=0,n=0;if(k>0){let r=S[t];for(;null!==r&&k-r<=2048;){let t=1;for(;k+t-1<x.length&&x[k+t]===x[r+t]&&(t++,!(t>=l)););if(t>e&&(e=t,n=r,e>=l))break;r=H[r]}}e>=3&&(t=C),y(j[t].code,j[t].bitNum);let r=1;if(t===C){const t=v(e-3);y(t.codeBuf,t.bitCnt);const o=k-n-1,i=f(Math.min(k-1,2047)),l=new Uint8Array(2);i<=8?l[0]=o<<8-i:(l[0]=o>>i-8,l[1]=o<<16-i&255),y(l,i),r=e}for(let t=0;t<r;t++)H.push(S[x.charCodeAt(k)]),S[x.charCodeAt(k)]=k,k++;E++,_[t]++}return p>0&&(s=(s<<g-p)+(j[w].code[0]>>p+8-g),u+=i?a[s]:String.fromCharCode(s)),u},expand:function(t,i=!0){let c,a,d;const p=new Uint8Array(t.length),g=i?6:8,v=()=>{const t=d>>g-a-1&1;return++a===g&&(a=0,c++,c<j&&(d=p[c])),t},y=()=>{let t=0,e=0;do{if(c>=p.length)return-1;if(t=v(),c>=p.length)return-1;t=(t<<1)+v(),t<3&&(e=3*e+t+1)}while(t<3);return e};if("string"!=typeof t||0===t.length)return null;for(let e=t.length,n=0;n<e;n++){let e;if(i){if(e=s.get(t[n]),void 0===e)return null}else if(e=t.charCodeAt(n),e>=256)return null;p[n]=e}c=0,a=0,d=p[0];const b=(()=>{let t=v();return t=(t<<1)+v(),t})(),m=n[b],C=r[b],w=o[b];let x=[];for(let t=0;t<m;t++)x.push(.25);let _="",S=h(x,m),H=S,A=0;const j=p.length;let k=0;for(;c<j;)if(H=v()?H.right:H.left,H.symbol>=0){if(H.symbol===w)break;if(H.symbol===C){const t=y();if(t<0)return null;const e=t+3;if(e>l)return null;let n=0;const r=f(Math.min(k-1,2047));for(let t=0;t<r;t++){if(c>=j)return null;n=(n<<1)+v()}if(n>=k)return null;for(let t=0;t<e;t++)_+=_[k-n-1+t];k+=e}else _+=String.fromCharCode(H.symbol),k++;x[H.symbol]++,A++,(A<256||A%8==0)&&(S=h(x,m)),H=S}if(0===b){if(_=e(_),null===_)return null}else if(3===b){t="";for(let e=_.length,n=0;n<e;n++)t+=String.fromCharCode(u[_.charCodeAt(n)]);_=t}return _},encodeUtf8:t,decodeUtf8:e}})();null!=t&&(t.exports=r)},896:t=>{"use strict";t.exports=require("fs")},611:t=>{"use strict";t.exports=require("http")},928:t=>{"use strict";t.exports=require("path")},932:t=>{"use strict";t.exports=require("process")}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={id:r,loaded:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}n.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),n(806)})();